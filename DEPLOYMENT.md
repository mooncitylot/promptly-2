# Deploying to Render

This guide will help you deploy your Promptly app to Render.

## 🚀 Quick Deploy

### Option 1: Using render.yaml (Recommended)

1. **Push your code to GitHub**
2. **Connect to Render:**

   - Go to [render.com](https://render.com)
   - Sign up/Login with GitHub
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

3. **Update CORS Origin:**
   - After deployment, update the `CORS_ORIGIN` environment variable in Render dashboard
   - Set it to your frontend URL (e.g., `https://your-frontend-app.onrender.com`)

### Option 2: Manual Setup

1. **Create a new Web Service:**

   - Go to [render.com](https://render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository

2. **Configure the service:**

   - **Name:** `promptly-backend`
   - **Environment:** `Node`
   - **Build Command:** `cd server && npm install && npm run build`
   - **Start Command:** `cd server && npm start`

3. **Set Environment Variables:**
   ```
   NODE_ENV=production
   DB_CLIENT=sqlite3
   DB_FILENAME=./database/promptly.db
   CORS_ORIGIN=https://your-frontend-app.onrender.com
   JWT_SECRET=your-secret-key-here
   JWT_EXPIRES_IN=24h
   RATE_LIMIT_WINDOW_MS=900000
   RATE_LIMIT_MAX_REQUESTS=100
   ```

## 🔧 Important Notes for Render

### Database Persistence

- **SQLite files are ephemeral** on Render's free tier
- Your database will reset when the service restarts
- For production, consider upgrading to a paid plan with persistent storage
- Or migrate to a managed database service (PostgreSQL on Render)

### Environment Variables

- `PORT` is automatically set by Render
- `NODE_ENV` should be `production`
- Update `CORS_ORIGIN` to your frontend URL

### Build Process

- The `build` script runs migrations to set up the database
- Sample data is seeded during the build process
- The database file is created in the `server/database/` directory

## 🌐 Frontend Integration

After deploying the backend, update your frontend API configuration:

```javascript
// In src/services/api-fetch.js
const DEFAULT_API = process.env.API_URL || 'https://your-backend-app.onrender.com/api/v1'
```

## 📊 Monitoring

### Health Check

Your API includes a health check endpoint:

```
GET https://your-backend-app.onrender.com/health
```

### Logs

- View logs in the Render dashboard
- Monitor for any database connection issues
- Check for CORS errors

## 🔄 Database Management

### Local Development

```bash
# Reset database
cd server && npm run db:reset

# Run migrations only
cd server && npm run db:migrate

# Seed data only
cd server && npm run db:seed
```

### Production (Render)

- Database is automatically set up during build
- To reset: redeploy the service
- For manual database operations, use Render's shell feature

## 🚨 Troubleshooting

### Common Issues

1. **Database Connection Failed**

   - Check if the database directory exists
   - Ensure write permissions
   - Verify environment variables

2. **CORS Errors**

   - Update `CORS_ORIGIN` environment variable
   - Check frontend URL is correct

3. **Build Failures**

   - Check Node.js version (>=18.0.0)
   - Verify all dependencies are in `package.json`
   - Check migration files are correct

4. **Service Won't Start**
   - Check logs in Render dashboard
   - Verify start command is correct
   - Ensure all environment variables are set

### Getting Help

- Check Render's [documentation](https://render.com/docs)
- View service logs in Render dashboard
- Test API endpoints using the health check

## 🔒 Security Considerations

- JWT_SECRET is auto-generated by Render
- CORS is configured for your frontend domain
- Rate limiting is enabled
- Security headers are set via Helmet.js

## 📈 Scaling

For production use:

1. **Upgrade to paid plan** for persistent storage
2. **Use managed PostgreSQL** instead of SQLite
3. **Set up monitoring** and alerts
4. **Configure custom domains**
